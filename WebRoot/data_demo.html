<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <title>JSTree</title>
    <link rel="stylesheet" type="text/css" href="css/style1.css" />
    <!-- <link href="css/bootstrsp.ziji.css" rel="stylesheet"> -->
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <!--  <link rel="stylesheet" href="bootstrap/css/bootstrap.min.css"> -->
    <link rel="stylesheet" href="dist/css/min.css">
    <link rel="stylesheet" href="dist/css/skins/_all-skins.css">
    <link rel="stylesheet" href="plugins/datepicker/datepicker3.css">
    <link rel="stylesheet" type="text/css" href="plugins/datepicker/daterangepicker.css" />
    <link rel="stylesheet" href="css/font-awesome.min.css">
    <link rel="stylesheet" href="css/ionicons.min.css">
    <link rel="stylesheet" href="js/handsontable/handsontable.full.css">
    <link href="css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">
    <link rel="stylesheet" href="js/themes/default/style.min.css">
    <!-- <script type="text/javascript" src="js/locales/bootstrap-datetimepicker.zh-CN.js" charset="UTF-8"></script> -->
    <link rel="stylesheet" href="js/jquery-ui-1.10.4/themes/base/jquery-ui.css">
    <!-- <link rel="stylesheet" href="http://jqueryui.com/resources/demos/style.css"> -->
    <style type="text/css">
    body {
        background: #353c48;
    }

    .format-img {
        min-width: 780px;
    }

    .format-img ul {
        margin: 0;
        padding: 0;
        list-style: none;
        float: left;
        width: 100%;
        background: #fff;
        text-align: center;
    }

    .format-img ul li {
        float: left;
        width: 14.285%;
        _width: 14.28%;
        line-height: 0;
        padding: 15px 0
    }

    .format-img ul li img {
        border: solid 0px #f08;
        padding: 0px;
        background: #fff;
    }
    </style>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />


</head>


<body>
    <!-- <div id="jstree_div"></div>   -->

    <body class="fixed-sidebar full-height-layout gray-bg" style="height:1080px;overflow-x:hidden ;">
        <div id="radio" style="margin-top: 20px;position: absolute;margin-left: 20px;">
            <input type="radio" id="radio1" name="radio" value="0" checked="checked"><label for="radio1" style="background: #343c48;color: #fff;border: 1px solid #95a0b1">&nbsp;数&nbsp;据&nbsp;</label>
        </div>
        <div style="width:80%;margin-left :250px;box-shadow: none">
            <div class="nav-tabs-custom" style="box-shadow: none;">
                <ul class="nav nav-tabs" style="border:none">
                    <p>
                        <div class="pull-right">
                            <table border="0" cellspacing="0" cellpadding="0" width="950">
                                <tr>
                                    <td width="1200" align="right">
                                        <form class="form-horizontal m-t">
                                            <label class="col-sm-2 control-label" style="margin-left:240px">选择日期：</label>
                                            <input id="dayInput" class="laydate-icon form-control layer-date" style="margin-right:100px;width:195px;color: #fff;"> <input onclick="setmonth(this)" name="tmon" id="tmon" style="display:none" />
                                            <select id="tyear" valign="middle" style="display:none">
                                        </form>
                                    </td>
                                    <td align="right"><button id="searchBtn" type="button" class="btn btn-block btn-default " style="width:100px;text-align:center;margin:8px 40px 0 0;" align="center">查询</button></td>
                                    <td><button id="export-file" type="button" class="btn btn-block btn-default " style="width:100px;text-align:center ; margin:8px 65px 0 0;" align="center">导出</button></td>
                                </tr>
                            </table>
                        </div>
                </ul>
                <div class="tab-content" style="width:100%;height:470px;position:relative;margin-top:20px;border-top:15px solid #343c48">
                    <div class="tab-pane active" id="tab_2" style="height:480px">
                        <div id="jhTitle"></div>
                        <div id="planChartDiv" style="width: 850px;">
                            <canvas id="planChart"></canvas>
                        </div>
                        <br>
                    </div>
                    <div class="tab-pane active" id="tab_1" style="height:480px;">
                        <div id="zjTitle" style="background: #2a3039;height: 65px;width: 101%;margin: -10px -10px;border-bottom: 1px solid #2a3039;padding:15px 20px;color: #fff;"></div>
                        <div id="showResult" style="position:absolute; left:600px; margin-top:200px;width:20px;height:200px">
                            <img src='load.gif' />
                        </div>
                        <div id="zjChartDiv" style="width:92%;height:400px;">
                            <canvas id="zjChart" style=" width:1300px;height:318px; margin-top:28px"></canvas>
                        </div>
                        <div id="dlChartDiv" style="width:92%;height:400px;display:none;">
                            <canvas id="dlChart" width="1300" height=318" style="margin-top:28px"></canvas>
                        </div>
                        <div id="dlmChartDiv" style="width:92%;height:300px;display:none;">
                            <canvas id="dlmChart" style="width:92%;height:300px;"></canvas>
                        </div>
                        <div id="dlyChartDiv" style="width:92%;height:100%;display:none;">
                            <canvas id="dlyChart" style="width:92%;height:300px"></canvas>
                        </div>
                        <div id="dlgChartDiv" style="width:92%;height:100%;display:none;">
                            <canvas id="dlgChart" style="width:92%;height:300px"></canvas>
                        </div>
                        <p id="mxinfo" style="position:absolute; left:10px; top:405px"></p>
                        <p id="mninfo" style="position:absolute; left:10px; top:433px"></p>
                    </div>
                    <div id="zjTitle1" style="background: #2a3039;height: 65px;width: 101.5%;margin: 10px -10px ;border-bottom: 1px solid #2a3039;padding:15px 20px;color: #fff;"></div>

                    <div id="editCell" class="hot handsontable" style="height:40px;width: 102%;margin: -10px 0 0 -50px;">
                    </div>
                </div>
            </div>
        </div>
        </div>
        <div class="totalnavigation">
            <ul class="ce" id="lv1">
            </ul>
        </div>
        <script src="plugins/jQuery/jquery-2.2.3.min.js"></script>
        <!-- <script src="js/DatePicker.js"></script> -->
        <script src="js/chart.js"></script>
        <!-- <script src="plugins/datepicker/bootstrap-datepicker.js"></script>
        <script src="plugins/datepicker/locales/bootstrap-datepicker.zh-CN.js"></script> -->
       <!--  <script type="text/javascript" src="plugins/datepicker/moment.js"></script>
        <script type="text/javascript" src="plugins/datepicker/daterangepicker.js"></script> -->
        <script src="js/bootstrap.min.js"></script>
       <!--  <script src="dist/js/app.js"></script>
        <script src="utils.js"></script>
        <script type="text/javascript" src="js/bootstrap-datetimepicker.js" charset="UTF-8"></script>
        <script src="js/jquery-1.9.1/jquery1.9.1.js"></script> -->
        <script src="js/jquery-ui-1.10.4/ui/jquery-ui.js"></script>
        <script src="js/handsontable/handsontable.full.js"></script>
        <script src="setup.js"></script>
        <!-- <script src="js/DDoc.js"></script> -->
        <!-- <script src="js/FileSaver.js"></script> -->
      <!--   <script src="js/jszip.js"></script> -->
        <script src="js/plugins/layer/laydate/laydate.js"></script>
        <script type="text/javascript" src="js/main.js"></script>
        
        <script type="text/javascript">
        var timeOutNum = 100000;
        var titleFontSize = 5;
        var columns1 = [{ data: 0, readOnly: true, type: 'text', wordWrap: false }, { data: 1, readOnly: true, type: 'text' }, { data: 2, readOnly: true, type: 'text' }, { data: 3, readOnly: true, type: 'text' }, { data: 4, readOnly: true, type: 'text' }, { data: 5, readOnly: true, type: 'text' }, { data: 6, readOnly: true, type: 'text' }, { data: 7, readOnly: true, type: 'text' }, { data: 8, readOnly: true, type: 'text' }, { data: 9, readOnly: true, type: 'text' }, { data: 10, readOnly: true, type: 'text' }, { data: 11, readOnly: true, type: 'text' }, { data: 12, readOnly: true, type: 'text' }, ];
        var colHeaders1 = [' ', '00', '05', '10', '15', '20', '25', '30', '35', '40', '45', '50', '55'];
        var tempMode = 1;
        var nowSearch = saveno;
        var nowtitle = "";
        var nowType = 1;
         $(function() {
            $(".format-img img").wrapAll("<ul></ul>");
            $(".format-img img").each(function() {
                $(this).wrap('<li></li>');
            });
            $(".format-img li:odd").css({ background: "#fff" });
        });

        $(function() {
            $(".thr li").click(function() {
                $(this).addClass("active");
                $(this).siblings().removeClass("active");
            });
        });



        var class_arr = new Array("one", "two", "three", "four", "five", "six", "seven");
        var tree_type = 1; // 1：小项目，没有用到room表;2:大项目，二级菜单是roomname 

        $("#radio").buttonset();





        // });


        $('input[type=radio]').change(function() {
            tempMode = this.value + 1;
            // alert(this.value);
            $(".thr").hide();
        });





        $(function() {

            //inst.open_node(selectedNode);  
            //alert(temp);
            console.log(prono);
            $.ajax({
                url: httpIp + 'tree',
                data: { pno: prono },
                dataType: "json",
                type: "POST",
                success: function(data) {
                    if (data) {

                        console.log(data);
                        data.data.forEach(function(v) {

                            $("#lv1").append("<li><a class=\"xz\" id=" + v[0] + " href=\"#\"> " + v[1] + "</a> <ul class=\"thr\" style=\" \" id=ul" + v[0] + "> </ul></li>");
                            $('#0').trigger('click');

                        });
                        console.log($("#lv1"));
                    } else {
                        $("#jstree_div").html("暂无数据！");
                    }
                }
            });
        });
        $("body").on("click", ".xz", function() {
            var lino = this.id;
            //console.log(lino); 
            //var radio_val = $("[name='radio']").filter(":checked").val(); // $("[name='radio']").filter(":checked").attr("id");
            console.log(tree_type,lino);
            $.ajax({

                url: httpIp + 'tree_2',
                dataType: "json",
                data: { dd: 0, kk: tree_type, rtu: lino },
                type: "POST",
                success: function(data) {
                    if (data) {

                         console.log(data);
                        $(".thr").hide();
                        $("#ul" + lino).empty();
                        $("#ul" + lino).show();
                        data.data.forEach(function(v) {

                            $("#ul" + lino).append("<li ><a class=\"mulu\" id=\"" +lino+"_"+v[0] + "\" href=\"##\" > " + v[1] + "</a> <div class=\"thr_nr\" id=\"boxscroll" + v[0] + "\"> </div></li>");
                            //console.log($("#ul"+lino)); 

                        });

                    } else {
                        $("#jstree_div").html("暂无数据！");
                    }
                }
            });
        });

        function checkRate(input) {
            var re = /^[0-9]+.?[0-9]*$/;
            //判断字符串是否为数字 //判断正整数 /^[1-9]+[0-9]*]*$/ 
            var nubmer = document.getElementById(input).value;

            if (!re.test(nubmer)) {
                alert("请输入数字");
                document.getElementById(input).value = "";
                return false;
            }
            return true;
        }
        $("body").on("click", ".mulu", function() {

            var nums = this.innerHTML;
            /*
            if (checkRate("itNum")) 
            {
               nums = $("#itNum").val();
              // alert($("#itNum").val());
            }else
            {
               nums=6;
            }
             */

            var apdstr = "";
            var tid = this.id;
            //var radio_val = $("[name='radio']").filter(":checked").val(); // $("[name='radio']").filter(":checked").attr("id");
            console.log(tree_type,tid,nums);
            $.ajax({
                url: httpIp + 'tree_3',
                dataType: "json",
                data: { dd: tid.split("_")[0], kk: tree_type, rtu: tid.split("_")[1], len: nums },
                type: "POST",
                success: function(data) {
                    if (data) {
                        console.log(data);
                        $(".thr_nr").hide();
                        $("#boxscroll" + tid.split("_")[1]).show();
                        //data.data.forEach(function(v){
                        for (var i = 0; i < data.data.length; i++) {
                            //console.log(data.data.length);
                            var jsonObj = JSON.parse(data.data[i]); //转换为json对象
                            if ((i % 7) == 0) apdstr = apdstr + "<ul>";
                            // console.log(i%7);
                            apdstr = apdstr + "<li class=\"" + class_arr[(i % 7)] + "\">  <a href=\"##\" >" + "<div class=\"biaoti1\">" + jsonObj[0] + "</div>";


                            for (var ii = 0; ii < (jsonObj.length - 1) / 2; ii++) {
                                if (jsonObj[ii * 2 + 1].length > 0)
                                    apdstr = apdstr + "<div class=\"mes\" id=" + jsonObj[ii * 2 + 1] + ">" + jsonObj[ii * 2 + 2] + "</div>";
                            }
                            apdstr = apdstr + " </a> </li>";
                            if ((i % 7) == 6) apdstr = apdstr + "</ul>";

                        }

                        //  });
                        apdstr = apdstr + "</ul>";
                         console.log(apdstr);
                        $("#boxscroll" + tid.split("_")[1]).empty();
                        $("#boxscroll" + tid.split("_")[1]).append(apdstr);
                    } else {
                        $("#jstree_div").html("暂无数据！");
                    }
                }
            });
        });


        function changeCol(col) {
            console.log(col);
            editHot.updateSettings({
                colHeaders: col
            });
        }

        editHot = new Handsontable(document.getElementById('editCell'), {
            columns: columns1,
            data: [],
            outsideClickDeselects: false,
            stretchH: 'all',
            colHeaders: colHeaders1,
            rowHeaders: false,
            fillHandle: false,
            colWidths: 70,

            contextMenu: false,
            disableVisualSelection: false,
            className: 'htCenter',
            enterBeginsEditing: false,
            multiSelect: true,
            beforeOnCellMouseDown: function(event, coords) {
                if (coords.row < 0) {
                    event.stopImmediatePropagation();
                }
            }
        });



        var button1 = document.getElementById('export-file');
        var exportPlugin1 = editHot.getPlugin('exportFile');

        button1.addEventListener('click', function() {
            var dstr = $('#dayInput').val();
            exportPlugin1.downloadFile('csv', {
                bom: false,
                columnDelimiter: ',',
                columnHeaders: true,
                exportHiddenColumns: true,
                exportHiddenRows: true,
                fileExtension: 'csv',
                filename: nowtitle + "_" + dstr,
                mimeType: 'text/csv',
                rowDelimiter: '\r\n',
                rowHeaders: false
            });
            delayGetImg();
        });


        function loadPlan(jz, mode, sn) {
            changeCol(eval("colHeaders1"));
            $("#timetype").hide();
            $.ajax({
                url: httpIp + 'getTfPlanAll',
                type: 'POST',
                async: true,
                data: { crew: jz, tab: mode, pId: sn ,userId:uid},
                timeout: timeOutNum,
                dataType: 'json',
                // beforeSend:beforeSend, //发送请求        
                complete: complete, //请求完成    
                success: function(data, textStatus, jqXHR) {
                    if (data.result == 1) {
                        nowtitle = data.jzName;
                        $("#zjTitle1").html("<font size='" + titleFontSize + "'>" + data.jzName + "  历史数据" + "</font>");
                        console.log(data);
                        editData = [];
                        editData = JSON.parse(JSON.stringify(data.data));

                        editHot.loadData(editData);

                    }
                },
                error: function(xhr, textStatus) {
                    editHot.loadData([]);
                }
            })
        }
        $("body").on("click", ".mes", function() {
            //$("#myframe").attr("src", 'qs/lsqxsj1.html?qxid='+this.id); 
            $(".thr_nr").hide();
            var value = $("[name='radio']").filter(":checked").val(); // $("[name='radio']").filter(":checked").attr("id");

            var tid = this.id
            var dstr = $('#dayInput').val();
            var sav = tid;
            nowSearch = sav;

            if (value == "0") // 条件       
            {
                loadTfPlan(dstr, 1, sav);
                loadPlan(dstr, 1, sav);
                $("#zjChartDiv").show();
                $("#dlChartDiv").hide();
            } else if (value == "1") //条件2 

            {
                loadPlan(dstr, 2, sav);
                loaddlPlan(dstr, 2, sav);
                $("#zjChartDiv").hide();
                $("#dlChartDiv").show();
            }




        })
        var now = new Date();
        //alert(now.getDate()+'-'+now.getMonth());  
        //格式化日，如果小于9，前面补0  
        var day = ("0" + now.getDate()).slice(-2);
        //格式化月，如果小于9，前面补0  
        var month = ("0" + (now.getMonth() + 1)).slice(-2);
        //拼装完整日期格式  
        var today = now.getFullYear() + "-" + (month) + "-" + (day);
        //完成赋值  
        $('#dayInput').val(today);


        //var dstr =$('#dayInput').val();




        $("#tttabSel1").click(function() {
            //tempMode = 1;
            //console.log(tempMode);
            $("#jstree_yc").show();
            $("#jstree_dn").hide();
            $("#seltd").hide();
            $("#ptd").hide();
            $("#seldm").text("请选择日期");
        });

        $("#tttabSel2").click(function() {
            //tempMode = 2;
            $("#jstree_dn").show();
            $("#jstree_yc").hide();
            $("#seltd").show();
            $("#ptd").show();


        });
        $("#seltd").change(function() {
            nowMode = $("#seltd").val();
            if ($("#seltd").val() == 3) {
                $("#seldm").text("请选择年份")
                $("#tyear").show();
                $("#tmon").hide();
                $("#dayInput").hide();

            } else if ($("#seltd").val() == 2) {
                $("#seldm").text("请选择月份")
                $("#tmon").show();
                $("#dayInput").hide();
                $("#tyear").hide();

            } else {
                $("#seldm").text("请选择日期");
                $("#tmon").hide();
                $("#dayInput").show();
                $("#tyear").hide();
            }

        });

        function destroyChart(msg) {

            if (zjChart != null) {
                zjChart.destroy()
            }
            $("#zjInfo").html(msg);
            $("#jhInfo").html(msg);
        }

        function destroydlChart(msg) {

            if (dlChart != null) {
                dlChart.destroy()
            }
            $("#zjInfo").html(msg);
            $("#jhInfo").html(msg);
        }

        //$("#zjInfo").html(msg);
        //$("#jhInfo").html(msg);

        var zjToolTip = []
        var ctx2 = document.getElementById("zjChart");
        var ctx1 = document.getElementById("dlChart").getContext("2d");
        var ctx3 = document.getElementById("dlmChart").getContext("2d");
        var ctx4 = document.getElementById("dlyChart").getContext("2d");
        //document.getElementById("canvas").getContext("2d");
        var zjChart = null;
        var dlChart = null;
        var dlmChart = null;
        var dlyChart = null;

        var planToolTip = []

        var planChart
        var tfPlanToolTip
        var planInfo;
        var nowPlanName = "";
        var dcPlanName = "";

        function setChartWidth() {
            var chartWidth = $(window).width() - 300
            $("#planChartDiv").css('width', chartWidth);
            $("#zjChartDiv").css('width', chartWidth);
            $("#dlChartDiv").css('width', chartWidth);
            $("#dlmChartDiv").css('width', chartWidth);
            $("#dlyChartDiv").css('width', chartWidth);
            $("#planChartDiv").css('height', 318);
            $("#zjChartDiv").css('height', 318);
            $("#dlChartDiv").css('height', 318);
            $("#dlmChartDiv").css('height', 318);
            $("#dlyChartDiv").css('height', 318);
            ctx1.width = chartWidth;
            ctx1.height = 318;
            ctx2.width = chartWidth;
            ctx2.height = 318;
            ctx3.width = chartWidth;
            ctx3.height = 318;
            ctx4.width = chartWidth;
            ctx4.height = 318;

        }
        setChartWidth();

        function beforeSend(XMLHttpRequest) {

            $("#showResult").show();
        }

        function complete(XMLHttpRequest, textStatus) {
            $("#showResult").hide();
        }

        function loadTfPlan(jz, mode, sn) {
             console.log(uid);
            $.ajax({
                url: httpIp + 'getTfData',
                type: 'POST',
                async: true,
                data: { crew: jz, crewLong: prono, pId: sn ,userId:uid},
                timeout: timeOutNum,
                dataType: 'json',
                beforeSend: beforeSend, //发送请求        
                complete: complete, //请求完成    
                success: function(data, textStatus, jqXHR) {
                    console.log(data);
                    if (data.result == 1) {
                        dcPlanName = data.planJson.jzName + "历史曲线";
                        $("#zjTitle").html("<font size='5'>" + data.planJson.jzName + "  历史曲线" + "</font>");
                        $("#mxinfo").html("<font size='3' color='#fff'>" + data.planJson.mx + "</font>");
                        $("#mninfo").html("<font size='3' color='#fff'>" + data.planJson.mn + "</font>");
                        //tfzjToolTip = data.planJson.tooltipArr
                        var info = ""
                        planInfo = data.planJson.infoArr;
                        for (var i = 0; i < data.planJson.infoArr.length; i++) {
                            info += data.planJson.infoArr[i] + "<br>"
                        }
                        destroyChart("");
                        //Chart.defaults.global.pointHitDetectionRadius=1
                        zjChart = new Chart(ctx2, {
                            type: 'line',
                            data: {
                                labels: data.planJson.labels,
                                datasets: [{
                                        label: data.planJson.jzName,
                                        fillColor: "rgba(48, 164, 255,0.2)",
                                        lineTension: 0,
                                        backgroundColor: "rgba(48, 164, 255, 0.3)",
                                        borderColor: "rgba(48, 164, 255, 1)",

                                        borderDash: [],
                                        borderDashOffset: 0.0,

                                        pointBorderColor: "rgba(48, 164, 255, 1)",
                                        pointBackgroundColor: "#fff",
                                        pointBorderWidth: 1,
                                        pointHoverRadius: 5,
                                        pointHoverBackgroundColor: "rgba(48, 164, 255, 1)",
                                        pointHoverBorderColor: "rgba(48, 164, 255,1)",
                                        pointHoverBorderWidth: 2,

                                        pointRadius: 1,
                                        pointHitRadius: 10,
                                        data: data.planJson.data,
                                        spanGaps: true
                                    },

                                    {
                                        label: "上限",
                                        fill: false,
                                        lineTension: 0,
                                        backgroundColor: "rgba(229, 229, 229, 0.3)",
                                        borderColor: "rgba(229, 229, 229, 1)",
                                        borderCapStyle: 'butt',
                                        borderDash: [],
                                        borderDashOffset: 0.0,
                                        borderJoinStyle: 'miter',
                                        pointBorderColor: "rgba(229, 229, 229, 1)",
                                        pointBackgroundColor: "#fff",
                                        pointBorderWidth: 1,
                                        pointHoverRadius: 5,
                                        pointHoverBackgroundColor: "rgba(229, 229, 229, 1)",
                                        pointHoverBorderColor: "rgba(220,220,220,1)",
                                        pointHoverBorderWidth: 2,
                                        pointRadius: 1,
                                        pointHitRadius: 10,
                                        data: data.planJson.dataup,
                                        spanGaps: true
                                    },
                                    {
                                        label: "下限",
                                        fill: false,
                                        lineTension: 0,

                                        borderColor: "rgba(158,158,158,1)",
                                        borderCapStyle: 'butt',
                                        borderDash: [],
                                        borderDashOffset: 0.0,
                                        borderJoinStyle: 'miter',
                                        pointBorderColor: "rgba(158,158,158,1)",
                                        pointBackgroundColor: "#fff",
                                        pointBorderWidth: 1,
                                        pointHoverRadius: 5,
                                        pointHoverBackgroundColor: "rgba(158,158,158,1)",
                                        pointHoverBorderColor: "rgba(220,220,220,1)",
                                        pointHoverBorderWidth: 2,
                                        pointRadius: 1,
                                        pointHitRadius: 10,
                                        data: data.planJson.datalow,
                                        spanGaps: true
                                    }
                                ]
                            },
                            options: {
                                //datasetStrokeWidth : 8,
                                scales: {
                                    xAxes: [{
                                        ticks: {
                                            autoSkip: true
                                        }
                                    }],
                                    yAxes: [{
                                        ticks: {
                                            autoSkip: true,
                                            beginAtZero: true
                                        }
                                    }],
                                },
                                /*
                                tooltips:
                                {
                                    callbacks:
                                    {
                                        label: function (tooltipItem, data) {
                                            return tfzjToolTip[tooltipItem.index]
                                        }
                                    }
                                }*/
                            }
                        });

                        tfPlanToolTip = data.planJson.tooltipArr
                        //$("#jhInfo").html(info); 


                    } else {
                        console.log('something wrong');
                    }
                },
                error: function(xhr, textStatus) {
                    destroyChart("加载失败")
                }
            })
            $("#tab_1").show();
            $("#tab_2").hide();
        }
        $("#searchBtn").click(function() {
            var tempMode = $("[name='radio']").filter(":checked").val(); // $("[name='radio']").filter(":checked").attr("id");
            tempMode = tempMode * 1 + 1;
            console.log(tempMode, nowSearch);
            var dstr = $('#dayInput').val();
            var mstr = $('#tmon').val();
            var ystr = $('#tyear').val();
            //if (tempMode == 1) {
                loadTfPlan(dstr, tempMode, nowSearch);
            /*} else {

                {
                    loaddlPlan(dstr, tempMode, nowSearch);
                    $("#dlChartDiv").show();
                    $("#dlmChartDiv").hide();
                    $("#dlyChartDiv").hide();
                }


            }*/
            /*
             var value = $("[name='radio']").filter(":checked").val(); // $("[name='radio']").filter(":checked").attr("id");
               
            
                 var dstr =$('#dayInput').val();
                    var sav = tid;
                   nowSearch = sav;
                    
                    if ( value=="0") // 条件       
                         {
                      loadTfPlan(dstr,1,sav);
                      loadPlan(dstr,1,sav); 
                      $("#zjChartDiv").show();
                      $("#dlChartDiv").hide(); 
             }
            else if ( value=="1") //条件2 
 
             {
                 loadPlan(dstr,2,sav);  
                loaddlPlan(dstr,2,sav);
                 $("#zjChartDiv").hide();
                      $("#dlChartDiv").show();
                      }    
                      
       */
        });

        var color = Chart.helpers.color;

        function loaddlPlan(jz, mode, sn) {


            console.log(jz + "___" + mode + "___" + sn);
            $.ajax({
                url: httpIp + 'getdlData',
                type: 'POST',
                async: true,
                data: { crew: jz, crewLong: mode, pId: sn },
                timeout: timeOutNum,
                dataType: 'json',
                beforeSend: beforeSend, //发送请求        
                complete: complete, //请求完成    
                success: function(data, textStatus, jqXHR) {

                    if (data.result == 1) {
                        console.log(data);
                        dcPlanName = data.planJson.jzName + "历史能耗";
                        $("#zjTitle").html("<font size='5'>" + data.planJson.jzName + "  历史能耗" + "</font>");
                        $("#mxinfo").html("<font size='3'>" + data.planJson.mx + "</font>");
                        $("#mninfo").html("<font size='3'>" + data.mn + "</font>");
                        tfzjToolTip = data.tooltipArr
                        var info = ""
                        planInfo = data.planJson.infoArr;
                        for (var i = 0; i < data.planJson.infoArr.length; i++) {
                            info += data.planJson.infoArr[i] + "<br>"
                        }
                        destroydlChart("");
                        //Chart.defaults.global.pointHitDetectionRadius=1
                        dlChart = new Chart(ctx1, {
                            type: 'bar',
                            data: {
                                labels: ["0点", "1点", "2点", "3点", "4点", "5点", "6点", "7点", "8点", "9点", "10点", "11点", "12点", "13点", "14点", "15点", "16点", "17点", "18点", "19点", "20点", "21点", "22点", "23点"],
                                datasets: [{
                                        label: "当天",
                                        backgroundColor: color(window.chartColors.red).alpha(0.5).rgbString(),
                                        borderColor: window.chartColors.red,
                                        borderWidth: 1,
                                        data: data.planJson.data

                                    },
                                    {
                                        label: "前一天",
                                        backgroundColor: color(window.chartColors.blue).alpha(0.5).rgbString(),
                                        borderColor: window.chartColors.red,
                                        borderWidth: 1,
                                        data: data.data

                                    }
                                ]
                            },
                            options: {
                                responsive: false,
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: false,
                                    text: 'Chart.js Bar Chart'
                                }
                            }
                        });

                        tfPlanToolTip = data.planJson.tooltipArr
                        //$("#jhInfo").html(info); 


                    } else {
                        destroyChart("无匹配数据")
                    }
                },
                error: function(xhr, textStatus) {
                    destroyChart("加载失败")
                }
            })
            $("#tab_1").show();
            $("#tab_2").hide();
        }




        function delayGetImg() {
            var doc = new DDoc();
            var bt = "";
            var title1 = dcPlanName;

            doc.addParagraph(title1, {
                font: "宋体",
                fontSize: "40",
                bold: true,
                color: "fff",
                textAlign: doc.AlignType.Center
            });
            doc.newLine();


            for (var i = 0; i < 1; i++) {
                //



                try {
                    var dcImg = zjChart.toBase64Image()
                    if (dcImg != "") {
                        doc.addImage(dcImg, 550, 300, {
                            textAlign: doc.AlignType.Cente
                        });
                    }
                } catch (e) {}



            }



            doc.generate(title1 + ".doc");
            // setTimeout(delayClose, 3000)
        }

        function getCurMon() {
            var date = new Date();
            date.setMonth(date.getMonth());
            var month = date.getMonth() + 1;
            var hours = date.getHours();
            var strDate = date.getDate();
            if (month >= 1 && month <= 9) {
                month = "0" + month;
            }
            if (strDate >= 0 && strDate <= 9) {
                strDate = "0" + strDate;
            }
            if (hours >= 0 && hours <= 9) {
                hours = "0" + hours;
            }

            var currentmon = date.getFullYear() + "-" + month
            return currentmon;
        }
        $("#creatDocBtn").click(function() {
            delayGetImg();
        });
        $("#searchBtn").click(function() {
            var dstr = $('#dayInput').val();
            console.log(tempMode);
            if (nowType == 1) { loadPlan(dstr, tempMode, nowSearch); } else {
                var aa = $("#ppt").val();
                loadPlan_dn(dstr, aa, nowSearch)
            }
        })

        loadTfPlan(today, prono, saveno);

        loadPlan(today, prono, saveno);



        laydate({ elem: "#dayInput", event: "focus" });
        var start = {
            elem: "#start",
            format: "YYYY/MM/DD hh:mm:ss",
            min: laydate.now(),
            max: "2099-06-16 23:59:59",
            istime: true,
            istoday: false,
            choose: function(datas) {
                end.min = datas;
                end.start = datas
            }
        };
        var end = {
            elem: "#end",
            format: "YYYY/MM/DD hh:mm:ss",
            min: laydate.now(),
            max: "2099-06-16 23:59:59",
            istime: true,
            istoday: false,
            choose: function(datas) { start.max = datas }
        };
        laydate(start);
        laydate(end);
        </script>
        <!--
    输入每个框内信息点的数量：<input type=text id="itNum" value=6> 
    <div  id="lv1"  style="border: 1px solid black; width: 400px; height: 100px;float: left;"  ></div>
    <div  id="lv2"  style="border: 1px solid black; width: 400px; height: 100px;float: left;"  ></div>
    <div  id="lv3"  style="border: 1px solid black; width: 1200px; height: 800px;float: left;"  ></div>
!-->
    </body>

</html>