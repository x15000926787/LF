<!DOCTYPE html>
<html lang="zh-cn">

<head>
	<style>
		.chart-container {
			height: 330px;
		}

		.chart-tooltip {
			position: absolute;
			display: none;
			padding: 5px;
			max-width: 200px;
			font-size: 12px;
			text-align: center;
			color: #fff;
			background-color: #000;
			border-radius: 4px;
			opacity: 0.8;
		}
		table  td {
			text-align:center;
			vertical-align:middle;
		}
		table  th {
			text-align:center;
		}
		table.gridtable {
			font-family: verdana,arial,sans-serif;
			font-size:11px;
			color:#333333;
			border-width: 1px;
			border-color: #666666;
			border-collapse: collapse;
		}
		table.gridtable th {
			border-width: 1px;
			padding: 8px;
			border-style: solid;
			border-color: #666666;
			background-color: #dedede;
		}
		table.gridtable td {
			border-width: 1px;
			padding: 8px;
			border-style: solid;
			border-color: #666666;
			background-color: #ffffff;
		}
		.chart {
			width: 100%;
			height: 400px;
		}
	</style>
	<!-- Bootstrap 3.3.6 -->
	<!-- Bootstrap 3.3.6 -->
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="dist/css/min.css">

	<!--<link rel="stylesheet" href="dist/css/skins/_all-skins.css">-->
	<!--<link rel="stylesheet" href="plugins/datepicker/datepicker3.css">-->
	<!--<link rel="stylesheet" type="text/css" href="plugins/datepicker/daterangepicker.css" />-->
	<link rel="stylesheet" href="css/font-awesome.min.css">
	<link rel="stylesheet" href="css/style_timer.css">
	<link rel="stylesheet" href="css/ionicons.min.css">
	<link rel="stylesheet" href="js/handsontable/handsontable.css">
	<!--<link href="css/bootstrap-datetimepicker.min.css" rel="stylesheet" media="screen">-->
	<link rel="stylesheet" href="css/style.min.css">

	<script src="js/jquery.min.js"></script>
	<script src="js/jstree.min.js"></script>


	<script src="js/bootstrap-datepicker.js"></script>
	<script type="text/javascript" src="js/datepicker/moment.js"></script>

	<script type="text/javascript" src="js/datepicker/daterangepicker.js"></script>
	<script src="js/bootstrap.min.js"></script>
	<!--<script src="js/app.js"></script>-->

	<script type="text/javascript" src="js/timepicker/bootstrap-timepicker.js" charset="UTF-8"></script>
	<script type="text/javascript" src="js/bootstrap-datetimepicker.js" charset="UTF-8"></script>

	<link data-jsfiddle="common" rel="stylesheet" media="screen" href="js/pikaday/pikaday.css">
	<script data-jsfiddle="common" src="js/pikaday/pikaday.js"></script>
	<script data-jsfiddle="common" src="js/moment/moment.js"></script>
	<script data-jsfiddle="common" src="js/zeroclipboard/ZeroClipboard.js"></script>


	<script data-jsfiddle="common" src="js/handsontable/handsontable.js"></script>
	<script src="setup.js"></script><!--
	<script src="js/DDoc.js"></script>
	&lt;!&ndash;<script src="js/FileSaver.js"></script>
	<script src="js/jszip.js"></script>&ndash;&gt;-->
	<!--<script src="js/timePacker.js"></script>-->

	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>

<script type="text/javascript">
	$(function(){
		$(".format-img img").wrapAll("<ul></ul>");
		$(".format-img img").each(function(){
			$(this).wrap('<li></li>');
		});
		$(".format-img li:odd").css({background:"#fff"});
	})
</script>
<style type="text/css">

	body{ background:#fff;}
	.format-img{min-width:780px;}
	.format-img ul{ margin:0; padding:0; list-style:none; float:left; width:100%; background:#fff; text-align:center;}
	.format-img ul li{ float:left; width:14.285%;_width:14.28%; line-height:0; padding:15px 0}
	.format-img ul li img{ border:solid 0px #f08; padding:0px; background:#fff;}
</style>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>

<body class="skin-blue layout-top-nav" style="height: auto;">
<header class="main-header">
	<nav >
		<!--
        <div class="format-img">
       <img src="b1.png"   style="cursor: pointer;" id="bt1" onclick="javascript:gotourl(0)"/>
       <img src="b2.png"  style="cursor: pointer;"  id="bt2" onclick="javascript:gotourl(1)"/>
       <img src="b3.png"  style="cursor: pointer;"  id="bt3" onclick="javascript:gotourl(2)"/>
       <img src="b4.png"  style="cursor: pointer;"  id="bt4" onclick="javascript:gotourl(3)"/>
       <img src="b5.png"  style="cursor: pointer;"  id="bt5" onclick="javascript:gotourl(4)"/>
       <img src="b6.png"  style="cursor: pointer;"  id="bt6" onclick="javascript:gotourl(5)"/>
        <img src="b7.png"  style="cursor: pointer;"  id="bt7" onclick="javascript:gotourl(6)"/>
        -->
		</div>
	</nav>
</header>
<br>


<div style="width:80%;margin-left :180px">
	<div class="nav-tabs-custom">
		<ul class="nav nav-tabs">
			<p>

			<div class="pull-right">

				<table border="0" cellspacing="0" cellpadding="0" width="950">
					<tr>
						<td width="100">



						</td>
						<td >
							<select id="ttp"  style="width:70px;height:25px">
								<option value=-1>所有站</option>

							</select>
						</td>
						<td >
							<select id="dev"  style="width:70px;height:25px">
								<option value=-1>所有站</option>

							</select>
						</td>




					</tr>
				</table>

			</div>


		</ul>
		<div id="zjTitle"></div>

		<div id="editCell" class="hot handsontable">

		</div>



	</div>








</div>


<script type="text/javascript">

	var nowJz = "all"
	var nowJzLong = "all"
	var nowPlanSn = 0
	var nowZhName = ""
	var timeOutNum = 100000;
	var titleFontSize = 5;
	/**
	 * 验证手机号
	 * @param value
	 * @param callback
	 */
	var phonenoValidator = function (value, callback) {
		//console.log(value+'__'+value.length)
		if (!value || 0 === value.length || value.length != 11 ) {
			callback(false);
		} else {
			callback(true);
		}
	};
	/**
	 * 验证Email
	 * @param strEmail
	 * @param callback
	 *
	 */
	var emailValidator = function (strEmail, callback) {
		//console.log(value+'__'+value.length)
		if (strEmail.search(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/) != -1) {
			callback(true);
		} else {
			callback(false);
		}
	};
	var columns1 = [
		{ data: 0, readOnly: true, type: 'text', wordWrap: false },
		{data: 1, readOnly: false, type: 'text'},
		{data: 2,type: 'text',validator: phonenoValidator},
		{data:3,renderer:'html',readonly:true},
		{data:4,renderer:'html',readonly:false},
		{data: 5,type: 'text',validator: emailValidator},
		{data:6,renderer:'html',readonly:false},
		{data:7,renderer:'html',readonly:false}];
	var colHeaders1 = ['ID', '姓名', '手机号', '接收短信','允许时间段','EMAIL', '接收Email',"<a id='addBtn' href='javascript:addRow()'><span class='fa fa-edit'></span></a>"];

	var nowTab = 1;
	var nowSearch = 0;
	var nowMode = 1;
	var tempMode = 1;
	var timeSearchTemp = "";

	var now = new Date();
	//alert(now.getDate()+'-'+now.getMonth());
	//格式化日，如果小于9，前面补0
	var day = ("0" + now.getDate()).slice(-2);
	//格式化月，如果小于9，前面补0
	var month = ("0" + (now.getMonth() + 1)).slice(-2);
	//拼装完整日期格式
	var today = now.getFullYear()+"-"+(month)+"-"+(day) ;
	//完成赋值
	$('#dayInput').val(today);
	// document.getElementById('dayInput').valueAsDate = new Date();
    function upchk(a,r,c)
	{
		var vv= $(a).val();
		if ($(a).get(0).checked) {
			editHot.setDataAtCell(r,c,true);
		}else
		{
			editHot.setDataAtCell(r,c,false);
		}

	}
	function upipt(v,r)
	{
		console.log($("#open"+r).val());
		var oo= $("#open"+r).val().split(':');
		var cc= $("#close_"+r).val().split(':');
		var aa = oo[0]*60+oo[1]*1;
		var bb = cc[0]*60+cc[1]*1;
		console.log(aa+','+bb);
		editHot.setDataAtCell(r,4,aa+','+bb);
		/*if ($(a).get(0).checked) {
			editHot.setDataAtCell(r,c,true);
		}else
		{
			editHot.setDataAtCell(r,c,false);
		}*/

	}
	function clcpt(a,e,r){

		timePacker($(a),e,r);
	}

	function timePacker(dom,e,r) {
		var hours = null;//存储 "时"
		var minutes = null;//存储 "分"
		var clientY = dom.offset().top + dom.height();//获取位置
		var clientX = dom.offset().left;
		var date = new Date();
		var nowHours = date.getHours();
		var nowMinutes = date.getMinutes();
		var time_hm=/^(0\d{1}|\d{1}|1\d{1}|2[0-3]):([0-5]\d{1})$/; //时间正则，防止手动输入的时间不符合规范
		var inputText = dom.is("input") ? dom.val():dom.text();
		//插件容器布局
		var html = '';
		html += '<div class="timePacker" style="z-index: 199">';
		html += '<div class="timePacker-hours" style="display: block;">';
		html += '<div class="timePacker-title"><span>小时</span></div>';
		html += '<div class="timePacker-content">';
		html += '<ul>';
		var i = 0;
		console.log(r);
		while (i < 24)
		{
			//var text = i < 10 ? "0" + i : i;
			if(inputText !== "" && Number(inputText.split(":")[0]) === i){
				html += '<li class="hoursList timePackerSelect">'+i+'</li>';
				hours = Number(inputText.split(":")[0]);
			}else{
				if(i === nowHours){
					html += '<li class="hoursList" style="color: #007BDB;">'+i+'</li>';
				}else{
					html += '<li class="hoursList">'+i+'</li>';
				}
			}
			i++;
		}
		html += '</ul>';
		html +=  '</div>';
		html += '</div>';
		html += '<div class="timePacker-minutes" style="display: none;">';
		html += '<div class="timePacker-title"><span>分钟</span><span class="timePacker-back-hours" title="返回小时选择"><img src="img/back.png"/> </span></div>';
		html += '<div class="timePacker-content">';
		html += '<ul>';
		var m = 0;
		while (m < 60)
		{
			var textM = m < 10 ? "0" + m : m;
			if(inputText !== "" && Number(inputText.split(":")[1]) === textM){
				html += '<li class="mList timePackerSelect">'+textM+'</li>';
				minutes = Number(inputText.split(":")[1]);
			}else{
				if(m === nowMinutes){
					html += '<li class="mList" style="color: #007BDB;">'+textM+'</li>';
				}else{
					html += '<li class="mList">'+textM+'</li>';
				}
			}
			m = m+5;
		}
		html += '</ul>';
		html +=  '</div>';
		html += '</div>';
		html += '</div>';
		if($(".timePacker").length > 0){
			$(".timePacker").remove();
		}
		$("body").append(html);
		$(".timePacker").css({
			position:"absolute",
			top:clientY,
			left:clientX
		});
		var _con = $(".timePacker"); // 设置目标区域,如果当前鼠标点击非此插件区域则移除插件
		$(document).mouseup(function(e){
			if(!_con.is(e.target) && _con.has(e.target).length === 0){ // Mark 1
				console.log(dom.val());
				_con.remove();
			}
		});
		//小时选择
		$(".hoursList").bind('click',function () {
			$(this).addClass("timePackerSelect").siblings().removeClass("timePackerSelect");
			hours = $(this).text();
			var timer = setTimeout(function () {
				$(".timePacker-hours").css("display","none");
				$(".timePacker-minutes").fadeIn();
				if(minutes !== null){
					var getTime = hours + ":" + minutes;
					if(time_hm.test(getTime)){
						dom.removeClass("errorStyle");
					}
					dom.is("input") ? dom.val(getTime):dom.text(getTime);
				}
				clearTimeout(timer);
			},100);

		});
		//返回小时选择
		$(".timePacker-back-hours").bind('click',function () {
			var timer = setTimeout(function () {
				$(".timePacker-minutes").css("display","none");
				$(".timePacker-hours").fadeIn();
				clearTimeout(timer);
			},500);
		});
		//分钟选择
		$(".mList").bind('click',function () {
			$(this).addClass("timePackerSelect").siblings().removeClass("timePackerSelect");
			minutes = $(this).text();
			var timer = setTimeout(function () {
				var getTime = hours + ":" + minutes;
				if(time_hm.test(getTime)){
					dom.removeClass("errorStyle");
				}
				dom.is("input") ? dom.val(getTime):dom.text(getTime);
				clearTimeout(timer);
				_con.remove();
				var oo= $("#open_"+r).val().split(':');
				var cc= $("#close_"+r).val().split(':');
				var aa = oo[0]*60+oo[1]*1;
				var bb = cc[0]*60+cc[1]*1;
				console.log(aa+','+bb);
				editHot.setDataAtCell(r,4,aa+','+bb);

			},500);



		})
	}
	function negativeValueRenderer_user(instance, td, row, col, prop, value, cellProperties) {

		//id = editHot.getDataAtCell(row,0);

		Handsontable.renderers.TextRenderer.apply(this, arguments);
		switch(prop) {
			case 3:

					var str="<input type='checkbox' id='chkmsg"+row+"' onchange='upchk(this,"+row+","+col+")'";
					if (value) str = str + " checked ";
					str = str + "/>";

					td.innerHTML = str;

				break;
			case 4:
				//console.log(value+","+row+","+col);
				var aa = 0 ,bb = 0;
				if (value!=null){
				var vals = value.split(',');
				aa = Math.floor(vals[0] / 60);
				bb = vals[0] % 60 ;
				cc = Math.floor(vals[1] / 60);
				dd = vals[1] % 60 ;
				aa = (""+(100+aa)).substring(1);
				bb = (""+(100+bb)).substring(1);
				cc = (""+(100+cc)).substring(1);
				dd = (""+(100+dd)).substring(1);

				//
				//Handsontable.renderers.HtmlRenderer.apply(this, arguments);
				var str="<input style='border: 1px solid #2a3039;' type=\"text\" onclick='clcpt(this,event,"+row+")' value='"+aa+":"+bb+"'  id='open_"+row+"' />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ~ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<input style='color: #fff;background: #2a3039;border: 1px solid #2a3039;' type=\"text\" onclick='clcpt(this,event,\"+row+\")' value='"+cc+":"+dd+"'  id=\"close_"+row+"\"  />";

				//console.log(str);
				td.innerHTML = str;
				}

				break;
			case 6:

				var str="<input type='checkbox' id='chkmail"+row+"'  onchange='upchk(this,"+row+","+col+")'";
				if (value) str = str + " checked ";
				str = str + "/>";

				td.innerHTML = str;

				break;
			case 7:
				Handsontable.renderers.HtmlRenderer.apply(this, arguments);
				break;
			case 5:
				//td.style = "display:none";
				break;
			default:
				;
		}


	}
	Handsontable.renderers.registerRenderer('userRenderer', negativeValueRenderer_user);

	editHot = new Handsontable(document.getElementById('editCell'),
			{
				columns: columns1,
				data: [],
				formulas: true,
				outsideClickDeselects: false,
				stretchH: 'all',
				colHeaders: colHeaders1,
				rowHeaders: false,
				fillHandle: false,
				colWidths: 60,
				contextMenu: false,
				disableVisualSelection: false,
				className: 'htCenter',
				enterBeginsEditing: false,
				multiSelect: true,
				beforeOnCellMouseDown: function (event, coords) {
					if (coords.row < 0) {
						event.stopImmediatePropagation();
					}
				},
				cells: function (row, col, prop) {
					var cellProperties = {};
					cellProperties.renderer = "userRenderer";
					if (col==4) cellProperties.readOnly = true;
					return cellProperties;
				}
			});

	function addRow() {
		if (editHot != null) {
			editHot.alter('insert_row', editHot.countRows());
			var lastRow = editHot.countRows() - 1;
			//editHot.setDataAtCell(lastRow, 1,lastRow+1)
			editHot.setDataAtCell(lastRow, 1, '');
			editHot.setDataAtCell(lastRow, 2, '');
			editHot.setDataAtCell(lastRow, 3, false);
			editHot.setDataAtCell(lastRow, 4, '0,1439');
			editHot.setDataAtCell(lastRow, 5, ' ');
			editHot.setDataAtCell(lastRow, 6, false);

			editHot.setDataAtCell(lastRow, 7, "<a id='subBtn' href='javascript:void(0);'><span class='fa fa-save'></span></a>&nbsp;&nbsp;&nbsp;&nbsp;<a id='delBtn' href='javascript:void(0);'><span class='glyphicon glyphicon-trash'></span></a>");
		}
	}


	function init() {

		loaddev(today,"1",0);
		// loadauthor();
		getuserauthor(4);
	}
	function beforeSend(XMLHttpRequest){
		console.log("ddd");
		$("#showResult").show();
	}
	function complete(XMLHttpRequest, textStatus){
		$("#showResult").hide();
	}
	function loadPlan(jz,mode,sn) {

		$.ajax({
			url: httpIp + '/LF/getuser',
			type: 'POST',
			async: true,
			data: { crew: jz, tab: mode, pId: 1 },
			timeout: timeOutNum,
			dataType: 'json',
			beforeSend:beforeSend, //发送请求
			complete:complete,//请求完成
			success: function (data, textStatus, jqXHR) {
				console.log(data.data);
				if (data.result == 1) {
					$("#zjTitle").html("<font size='" + titleFontSize + "'>"  + "  短信用户列表" + "</font>");

					// $("#authorTitle").html("<font size='" + titleFontSize + "'>" +data.data[0][1] + "  短信权限列表" + "</font>");
					//$("#authorTitle2").html(" " +data.data[0][1] + " " + "</font>");
					editData = [];

					editData = JSON.parse(JSON.stringify(data.data));
					editDataBk = JSON.stringify(editData);
					editHot.loadData(editData)

				}
				else {
					editData = [];
					editDataBk = JSON.stringify(editData);
				}
			},
			error: function (xhr, textStatus) {
				editHot.loadData([]);
			}
		})
		//$("#rm2").append(" ddd &nbsp;<input  type=checkbox > </option>&nbsp;&nbsp;");
		//$("#rm2").append(" ddd &nbsp;<input  type=checkbox > </option>&nbsp;&nbsp;");

	}
	function loadauthor() {

		$.ajax({
			url: httpIp + '/LF/getauthor',
			type: 'POST',
			async: false,
			timeout: timeOutNum,
			dataType: 'json',
			beforeSend:beforeSend, //发送请求
			complete:complete,//请求完成
			success: function (data, textStatus, jqXHR) {
				if (data.result == 1) {
					console.log(data);
					roomno = [];
					deviceno = [];
					devicenm = [];
					roomno = JSON.parse(JSON.stringify(data.roomno));
					deviceno = JSON.parse(JSON.stringify(data.deviceno));
					devicenm = JSON.parse(JSON.stringify(data.devicenm));
					for (var i=0;i<15;i++)
						$("#rm"+i).html("");
					for (var i=0;i<roomno.length;i++)
					{

						$("#rm"+roomno[i]).append(devicenm[i]+"&nbsp;<input id='ck"+deviceno[i]+"' name='chkItem' type=checkbox > </option>&nbsp;&nbsp;");

					}

				}
			},
			error: function (xhr, textStatus) {
				editHot.loadData([]);
			}
		})
		//$("#rm2").append(" ddd &nbsp;<input  type=checkbox > </option>&nbsp;&nbsp;");
		//$("#rm2").append(" ddd &nbsp;<input  type=checkbox > </option>&nbsp;&nbsp;");

	}
	function saveauthor() {
		var strs="";
		for (var i=0;i<100;i++)
		{
			if ($("#ck"+i).prop("checked")) strs=strs+i+",";
		}
		strs=strs+"99";
		$.ajax({
			url: httpIp + '/LF/set_author',
			type: 'POST',
			async: false,
			timeout: timeOutNum,
			data:{devs:strs,uid:nowMode},
			dataType: 'json',
			beforeSend:beforeSend, //发送请求
			complete:complete,//请求完成
			success: function (data, textStatus, jqXHR) {
				if (data.result == 1) {
					console.log(data);
					alert('提交成功');

				}
			},
			error: function (xhr, textStatus) {
				editHot.loadData([]);
			}
		})
		//$("#rm2").append(" ddd &nbsp;<input  type=checkbox > </option>&nbsp;&nbsp;");
		//$("#rm2").append(" ddd &nbsp;<input  type=checkbox > </option>&nbsp;&nbsp;");

	}
	function getuserauthor(sn,nm) {
		nowMode=sn;
		//loadauthor();
		// $("#authorTitle").html("<font size='" + titleFontSize + "'>" +nm + "  短信权限列表" + "</font>");
		$("#authorTitle").html(" " +nm + "  " + "</font>");
		$.ajax({
			url: httpIp + '/LF/getUserAuthor',
			type: 'POST',
			async: false,
			timeout: timeOutNum,
			data : {uId :sn},
			dataType: 'json',
			beforeSend:beforeSend, //发送请求
			complete:complete,//请求完成
			success: function (data, textStatus, jqXHR) {
				if (data.result == 1) {
					console.log(data);

					deviceno = [];


					deviceno = JSON.parse(JSON.stringify(data.deviceno));

					// $("[name = chkItem]:checkbox").attr("checked", false);
					for (var i=0;i<deviceno.length;i++)
					{
						// $("#rm"+roomno[i]).append(devicenm[i]+"&nbsp;<input id="+deviceno[i]+" type=checkbox > </option>&nbsp;&nbsp;");
						$("#ck"+deviceno[i]).prop("checked", true);
					}


				}
			},
			error: function (xhr, textStatus) {
				editHot.loadData([]);
			}
		})
		//$("#rm2").append(" ddd &nbsp;<input  type=checkbox > </option>&nbsp;&nbsp;");
		//$("#rm2").append(" ddd &nbsp;<input  type=checkbox > </option>&nbsp;&nbsp;");

	}
	function findSN(sn, newJson) {
		for (var i = 0; i < newJson.length; i++) {
			if (newJson[i][0] == sn) {
				return true;
			}
		}
		return false;
	}
	function findNewEdit(sn, newJson) {
		for (var i = 0; i < newJson.length; i++) {
			if (newJson[i][0] == sn) {
				return newJson[i]
			}
		}
		return null
	}


	function findEdit(node, newJson) {
		for (var i = 0; i < newJson.length; i++) {
			//console.log("newjson:"+newJson[i].toString());
			//console.log("node:"+node);
			if ( node.indexOf(newJson[i].toString())>=0) {
				return false;
			}
		}
		return true;

	}
	function allcheck() {
		for (var i = 0; i < 100; i++) {

			$("#ck"+i).prop("checked", true);
		}
	}
	function allnotcheck() {
		for (var i = 0; i < 100; i++) {

			$("#ck"+i).prop("checked", false);
		}
	}
	function notcheck() {
		for (var i = 0; i < 100; i++) {
			if ($("#ck"+i).prop("checked"))
			{
				$("#ck"+i).prop("checked", false);
			}
			else
			{
				$("#ck"+i).prop("checked",true);
			}
			//$("#ck"+i).attr("checked", false);
		}
	}
	$(document).on("click", "#subBtn", function () { submitCell(); });
	$(document).on("click", "#delBtn", function () { if (editHot.getSelected() != null) {if (window.confirm("确认删除该用户?")==true){ editHot.alter('remove_row', editHot.getSelected()[0]); submitCell(); }} });
	$(document).on("click", "#savBtn", function () { saveauthor(); });
	$(document).on("click", "#allBtn", function () { allcheck(); });
	$(document).on("click", "#allnotBtn", function () { allnotcheck(); });
	$(document).on("click", "#notBtn", function () { notcheck(); });


	function submitCell() {

		editHot.validateCells(function (result) {

			if (result == true) {
				var addArr = []
				var editArr = []
				var delArr = []
				var oldJson

				if (editDataBk == "") {
					oldJson = []
				}
				else {
					oldJson = JSON.parse(editDataBk)
				}
				/*for (var i = 0; i < editHot.getData().length; i++) {
					console.log($("#open_"+i).val());
					var oo= $("#open_"+i).val().split(':');
					var cc= $("#close_"+i).val().split(':');
					var aa = oo[0]*60+oo[1]*1;
					var bb = cc[0]*60+cc[1]*1;
					console.log(aa+','+bb);
					editHot.setDataAtCell(i,4,aa+','+bb);

				}*/
				var newJson = editHot.getData();

				for (var i = 0; i < oldJson.length; i++) {
					var sn = oldJson[i][0]

					var have = findSN(sn, newJson)
					if (have) {
						var edited = findEdit(oldJson[i].toString(), newJson)
						if (edited) {
							var editNode = findNewEdit(sn, newJson)
							if (editNode != null) {
								editArr.push(editNode)
							}
						}
					}
					else {
						delArr.push(sn);
					}
				}
//console.log(editArr.toString());
				for (var j = 0; j < newJson.length; j++) {
					if (newJson[j][0] == null || newJson[j][0] == "") {
						addArr.push(newJson[j])
					}
				}
				//console.log(addArr + "  oldjson ")
				if (addArr.length == 0 && editArr.length == 0 && delArr.length == 0) {
					alert('没有更新内容')
					return;
				}

				var postObj = {}
				postObj.addArr = addArr
				postObj.editArr = editArr
				postObj.delArr = delArr
				var postJson = JSON.stringify(postObj)
				//postJson = postJson.replace(/降至/g, 0).replace(/升至/g, 1);
				//postJson = jzReplace(postJson)
				//console.log(postJson + "  json ")

				$.ajax({
					url: httpIp + '/LF/saveyTfEdit',
					type: 'POST',
					async: true,
					data: { jsonStr: postJson, sn: nowPlanSn },
					timeout: timeOutNum,
					dataType: 'text',
					beforeSend: function (xhr) {

					},
					success: function (data, textStatus, jqXHR) {
						data = JSON.parse(data)
						if (data.result == 1) {

							//console.log(data)
							loadPlan(nowPlanSn,1,1)

							alert('提交成功')

						}
						else {
							alert('提交失败')
						}


					},
					error: function (xhr, textStatus) {
						alert('提交失败')
						console.log(xhr)
						console.log(textStatus)
					},
					complete: function () {
					}
				})

			}
			else {
				alert('手机号或Email地址填写错误')
			}
		});

	}


	init();


</script>

</body>

</html>